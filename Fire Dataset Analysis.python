{"version":"NotebookV1","origId":4116714212312313,"name":"Fire Dataset Analysis","language":"python","commands":[{"version":"CommandV1","origId":2743960639127626,"guid":"e6aafb05-7117-466a-903d-1608ea23c060","subtype":"command","commandType":"auto","position":9.25,"command":"%md ## Introduction to Spark","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"05f4707f-19ee-4470-9b1e-babc72305fc9"},{"version":"CommandV1","origId":2743960639127627,"guid":"ecb7e298-ce03-40d0-9fba-017b70d412a2","subtype":"command","commandType":"auto","position":9.375,"command":"%md Our software tool to do the data analysis will be Apache Spark.\n\nSpark is a unified processing engine that can analyze big data using SQL, machine learning, graph processing or real time stream analysis:\n\n![Spark Engines](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_4engines.png)\n\nWe will mostly focus on Spark SQL and DataFrames this evening.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a6e20faf-71b1-4709-a0a1-5dc4ec21a2fb"},{"version":"CommandV1","origId":2743960639127628,"guid":"fada3890-7e3a-4522-96c0-bce9ff3297fc","subtype":"command","commandType":"auto","position":9.4375,"command":"%md Spark can read from many different databases and file systems and run in various environments:\n\n![Spark Goal](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_goal.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c9edf0c4-e560-4057-9013-0b5fd82fefab"},{"version":"CommandV1","origId":2743960639127629,"guid":"6d07fd59-f4bc-443f-a525-9e387305c924","subtype":"command","commandType":"auto","position":9.46875,"command":"%md Although Spark supports four languages (Scala, Java, Python, R), tonight we will use Python.\nBroadly speaking, there are **2 APIs** for interacting with Spark:\n- **DataFrames/SQL/Datasets:** general, higher level API for users of Spark\n- **RDD:** a lower level API for spark internals and advanced programming","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2cf394a5-1f7c-4579-9b09-b1bc1f32f3c2"},{"version":"CommandV1","origId":2743960639127630,"guid":"613ffb0d-a4da-4c22-be77-e1da93702cc5","subtype":"command","commandType":"auto","position":9.484375,"command":"%md A Spark cluster is made of one Driver and many Executor JVMs (java virtual machines):","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e632ea8b-9588-42a7-8d19-5616651881c8"},{"version":"CommandV1","origId":2743960639127631,"guid":"1942983e-3266-4ca6-8fb2-4db2fc4a3518","subtype":"command","commandType":"auto","position":9.4921875,"command":"%md ![Spark Physical Cluster, slots](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_cluster_slots.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2d6ffa61-2ca1-46b8-ba4b-ef3c57459d9a"},{"version":"CommandV1","origId":2743960639127632,"guid":"8be3036f-1750-4063-8839-6fa1f2ed14b1","subtype":"command","commandType":"auto","position":9.49609375,"command":"%md The Driver sends Tasks to the empty slots on the Executors when work has to be done:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1bc86150-d47d-4b0a-9a19-ffd2de3ffa51"},{"version":"CommandV1","origId":2743960639127633,"guid":"5d1bbd9f-9ad2-4bed-8431-e66d4fa8168e","subtype":"command","commandType":"auto","position":9.498046875,"command":"%md ![Spark Physical Cluster, tasks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_cluster_tasks.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9e817cb9-17c0-42fb-9091-fd6eec622887"},{"version":"CommandV1","origId":2743960639127634,"guid":"6bc9c487-b411-4223-933f-ecbf3f10e86e","subtype":"command","commandType":"auto","position":9.4990234375,"command":"%md In Databricks Community Edition, everyone gets a local mode cluster, where the Driver and Executor code run in the same JVM. Local mode clusters are typically used for prototyping and learning Spark:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"904d619c-17f3-44a9-9643-72bdacecc6de"},{"version":"CommandV1","origId":2743960639127635,"guid":"39001efa-644d-4a77-bf5e-299e4b2a3406","subtype":"command","commandType":"auto","position":9.49951171875,"command":"%md ![Notebook + Micro Cluster](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/notebook_microcluster.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2e9ce97e-d4a7-4c84-840b-6f36d21215f9"},{"version":"CommandV1","origId":2743960639127636,"guid":"e3e0ffe3-6535-4306-b330-8cfe114fc5d8","subtype":"command","commandType":"auto","position":9.499755859375,"command":"%md ## Introduction to Fire Department Calls for Service","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4f6eed6b-0ca5-4b62-abea-1a6cf701c940"},{"version":"CommandV1","origId":2743960639127637,"guid":"bd1b90ee-bf57-4b48-8d7a-84b56d36fde4","subtype":"command","commandType":"auto","position":9.4998779296875,"command":"%md The latest January 5th, 2019 copy of the \"Fire Department Calls for Service\" data set has been uploaded to Azure Blob. You can see the data with the `%fs ls` command:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"71b203c6-7f4a-472e-a461-72a43ac1692c"},{"version":"CommandV1","origId":2743960639127638,"guid":"de780034-d158-416d-b450-e8d713dac545","subtype":"command","commandType":"auto","position":9.49993896484375,"command":"%fs ls /mnt/firedata/Fire_Department_Calls_for_Service.csv","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546579623702,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ebcc33dd-ccca-45e5-aacf-70247b6379f7"},{"version":"CommandV1","origId":2743960639127641,"guid":"0ca68138-7ab2-4a4a-9de0-a44e55741568","subtype":"command","commandType":"auto","position":9.499969482421875,"command":"%md Note, you can also access the 1.7 GB of data directly from sfgov.org via this link: https://data.sfgov.org/Public-Safety/Fire-Department-Calls-for-Service/nuek-vuh3","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e1d93029-beb5-42e7-99b4-910bddde0db7"},{"version":"CommandV1","origId":2743960639127642,"guid":"cc60e22c-683f-44c8-ac53-720f5ebebf94","subtype":"command","commandType":"auto","position":9.499984741210938,"command":"%md Create a DataFrame from the CSV file by inferring the schema:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0a1ea42c-fb89-4d51-8af6-705e047b6109"},{"version":"CommandV1","origId":2743960639127643,"guid":"959377c2-cbb0-44cf-b205-9a1948543eba","subtype":"command","commandType":"auto","position":9.499992370605469,"command":"fireServiceDF = spark.read.csv('/mnt/firedata/Fire_Department_Calls_for_Service.csv', header=True, inferSchema=True)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546581754615,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f021c1cc-48d4-4db0-a8cd-0f62ee82a8c2"},{"version":"CommandV1","origId":2743960639127644,"guid":"b73dcb28-531b-4425-bf59-a44d136ff7db","subtype":"command","commandType":"auto","position":9.499996185302734,"command":"%md Notice that the above cell takes ~30 seconds to run b/c it is inferring the schema by sampling the file and reading through it.\n\nInferring the schema works for ad hoc analysis against smaller datasets. But when working on multi-TB+ data, it's better to provide an **explicit pre-defined schema manually**, so there's no inferring cost:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"45218a35-fa45-4911-a5a0-af29f53c1782"},{"version":"CommandV1","origId":2743960639127645,"guid":"1edcc84b-2a95-4865-91e9-781145b9ce35","subtype":"command","commandType":"auto","position":9.75,"command":"# Note that we are removing all space characters from the col names to prevent errors when writing to Parquet later\n\nfireSchema = StructType([StructField('CallNumber', IntegerType(), True),\n                     StructField('UnitID', StringType(), True),\n                     StructField('IncidentNumber', IntegerType(), True),\n                     StructField('CallType', StringType(), True),                  \n                     StructField('CallDate', StringType(), True),       \n                     StructField('WatchDate', StringType(), True),       \n                     StructField('ReceivedDtTm', StringType(), True),       \n                     StructField('EntryDtTm', StringType(), True),       \n                     StructField('DispatchDtTm', StringType(), True),       \n                     StructField('ResponseDtTm', StringType(), True),       \n                     StructField('OnSceneDtTm', StringType(), True),       \n                     StructField('TransportDtTm', StringType(), True),                  \n                     StructField('HospitalDtTm', StringType(), True),       \n                     StructField('CallFinalDisposition', StringType(), True),       \n                     StructField('AvailableDtTm', StringType(), True),       \n                     StructField('Address', StringType(), True),       \n                     StructField('City', StringType(), True),       \n                     StructField('ZipcodeofIncident', IntegerType(), True),       \n                     StructField('Battalion', StringType(), True),                 \n                     StructField('StationArea', StringType(), True),       \n                     StructField('Box', StringType(), True),       \n                     StructField('OriginalPriority', StringType(), True),       \n                     StructField('Priority', StringType(), True),       \n                     StructField('FinalPriority', IntegerType(), True),       \n                     StructField('ALSUnit', BooleanType(), True),       \n                     StructField('CallTypeGroup', StringType(), True),\n                     StructField('NumberofAlarms', IntegerType(), True),\n                     StructField('UnitType', StringType(), True),\n                     StructField('Unitsequenceincalldispatch', IntegerType(), True),\n                     StructField('FirePreventionDistrict', StringType(), True),\n                     StructField('SupervisorDistrict', StringType(), True),\n                     StructField('NeighborhoodDistrict', StringType(), True),\n                     StructField('Location', StringType(), True),\n                     StructField('RowID', StringType(), True)])","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546581987977,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f2e67577-149e-48a7-af04-983d844d4344"},{"version":"CommandV1","origId":2743960639127646,"guid":"6d17c096-1c8d-4fac-8a9d-6209d6738ed0","subtype":"command","commandType":"auto","position":9.875,"command":"#Notice that no job is run this time\nfireServiceCallsDF = spark.read.csv('/mnt/firedata/Fire_Department_Calls_for_Service.csv', header=True, schema=fireSchema)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546582021920,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"552360ae-2b8f-4963-b44a-afde5c9b957b"},{"version":"CommandV1","origId":2743960639127647,"guid":"65e5d84d-7b7f-4f96-85e0-aa4cb46716ae","subtype":"command","commandType":"auto","position":9.9375,"command":"%md Look at the first 5 records in the DataFrame:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c367e566-c671-413d-8f3c-ca80a8e81518"},{"version":"CommandV1","origId":2743960639127648,"guid":"6a61591f-0fbb-4395-9c33-510a77d266eb","subtype":"command","commandType":"auto","position":9.96875,"command":"display(fireServiceCallsDF.limit(5))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546582171768,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a3501f59-97e1-4e7c-9bce-9b4803e42229"},{"version":"CommandV1","origId":2743960639127649,"guid":"b0d52093-79fa-47ba-a314-f9c04c059b7e","subtype":"command","commandType":"auto","position":9.984375,"command":"%md Print just the column names in the DataFrame:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b29eba6c-20fd-41c8-8218-bede90c8e640"},{"version":"CommandV1","origId":2743960639127650,"guid":"eda3bdff-939c-4ce6-bf2f-924f47ffd7b9","subtype":"command","commandType":"auto","position":9.9921875,"command":"fireServiceCallsDF.columns","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546582255253,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e750edd9-ec2d-4fa3-b59c-7a16c38efd0c"},{"version":"CommandV1","origId":2743960639127651,"guid":"1079deb1-fe0c-4a51-824d-f303260c3eae","subtype":"command","commandType":"auto","position":9.99609375,"command":"%md Count how many rows total there are in DataFrame (and see how long it takes to do a full scan from remote disk/Blob Storage):","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"93b903f1-ed5f-48f2-9833-5c307e7dee5d"},{"version":"CommandV1","origId":2743960639127652,"guid":"c2676be4-4801-4d5f-a8e7-fc4208c635fc","subtype":"command","commandType":"auto","position":9.998046875,"command":"fireServiceCallsDF.count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546582435986,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"85868ed6-a3e2-4be7-bf6d-59a499b53142"},{"version":"CommandV1","origId":2743960639127653,"guid":"c2953110-470b-4565-9b54-f0d535081836","subtype":"command","commandType":"auto","position":9.9990234375,"command":"%md There are over 4 million rows in the DataFrame and it takes ~30 seconds to do a full read of it.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"844a87dd-416b-4a3c-b08c-f21c53f515d6"},{"version":"CommandV1","origId":2743960639127654,"guid":"d4449267-a4f1-48ec-8b73-421804149e76","subtype":"command","commandType":"auto","position":9.99951171875,"command":"%md Open the Apache Spark documentation in new tabs, so you can easily reference the API guide:\n\n1) Spark 2.4 docs: https://people.apache.org/~pwendell/spark-nightly/spark-master-docs/\n\n2) DataFrame user documentation: https://people.apache.org/~pwendell/spark-nightly/spark-master-docs/latest/sql-programming-guide.html\n\n3) PySpark API docs: https://people.apache.org/~pwendell/spark-nightly/spark-master-docs/latest/api/python/index.html","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"347bf15a-8666-4ffb-a4c5-f9b4fcffb5d3"},{"version":"CommandV1","origId":2743960639127655,"guid":"c753b688-f724-4af5-9e96-c1398af1f687","subtype":"command","commandType":"auto","position":9.999755859375,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **Analysis with PySpark DataFrames API**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4ed49bba-948a-4431-8d52-9c176cf844fa"},{"version":"CommandV1","origId":2743960639127656,"guid":"a6dfc856-ce12-4730-90db-ac0bb9548984","subtype":"command","commandType":"auto","position":9.9998779296875,"command":"%md ####![Spark Operations](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/spark_ta.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b732194e-d3e4-481d-bf5c-5f75b26a0060"},{"version":"CommandV1","origId":2743960639127657,"guid":"7e075d07-96b3-4e16-881b-58bd628a951b","subtype":"command","commandType":"auto","position":9.99993896484375,"command":"%md DataFrames support two types of operations: *transformations* and *actions*.\n\nTransformations, like `select()` or `filter()` create a new DataFrame from an existing one.\n\nActions, like `show()` or `count()`, return a value with results to the user. Other actions like `save()` write the DataFrame to distributed storage (like Blob or HDFS).","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"59c46654-502d-4335-926d-2a626e80c5a2"},{"version":"CommandV1","origId":2743960639127658,"guid":"455a79eb-3f7f-47d4-b13f-9a6e2a862b99","subtype":"command","commandType":"auto","position":9.999969482421875,"command":"%md ####![Spark T/A](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pagecounts/trans_and_actions.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fbb7f26d-1acf-4307-b7e4-d1ade4dfdd52"},{"version":"CommandV1","origId":2743960639127659,"guid":"ebd902b4-a384-4f0b-86e8-8aa5303dfffd","subtype":"command","commandType":"auto","position":9.999984741210938,"command":"%md Transformations contribute to a query plan,  but  nothing is executed until an action is called.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"13282e3d-0cca-4832-87f0-17b1d4729c4d"},{"version":"CommandV1","origId":2743960639127660,"guid":"b77db471-b37b-4252-8d1b-8aafa9f0252e","subtype":"command","commandType":"auto","position":9.999992370605469,"command":"%md **Q-1) How many different types of calls were made to the Fire Department?**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2845db58-5878-4ea8-8e25-083e3a03f1d8"},{"version":"CommandV1","origId":2743960639127661,"guid":"b7ffaa3c-e15a-459f-8d46-dc493de6a87a","subtype":"command","commandType":"auto","position":9.999996185302734,"command":"# Use the .select() transformation to yank out just the 'Call Type' column, then call the show action\nfireServiceCallsDF.select('CallType').show(5)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546582881951,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c94b8c44-d9ac-4498-b6e8-5c19140ea516"},{"version":"CommandV1","origId":2743960639127662,"guid":"d79f8b42-6e39-4456-a290-20e3250c04ae","subtype":"command","commandType":"auto","position":9.999998092651367,"command":"%md Seems like the Fire department is called for medical incidents far more than any other type. Note that the above command took about 35 seconds to execute. In an upcoming section, we'll cache the data into memory for up to 100x speed increases.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"427633ab-fbe3-447d-9a73-5025f9c74627"},{"version":"CommandV1","origId":2743960639127663,"guid":"5bf2717e-5df1-4b5a-a0d2-d2323e8f7e1d","subtype":"command","commandType":"auto","position":9.99999713897705,"command":"# Add the .distinct() transformation to keep only distinct rows\n# The False below expands the ASCII column width to fit the full text in the output\n\nfireServiceCallsDF.select('CallType').distinct().show(35, False)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546582900470,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f202ab3f-ba24-41be-a9da-ccda7910e286"},{"version":"CommandV1","origId":2743960639127664,"guid":"4e50e7bc-7615-49c1-9efd-cf19851419e7","subtype":"command","commandType":"auto","position":9.999997615814209,"command":"%md **Q-2) How many incidents of each call type were there?**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4321ed5b-f396-4648-aac0-d600f609bf56"},{"version":"CommandV1","origId":2743960639127665,"guid":"dcb42eff-72a0-4f43-bbc7-e0dfcade0529","subtype":"command","commandType":"auto","position":9.999997854232788,"command":"#Note that .count() is actually a transformation here\n\ndisplay(fireServiceCallsDF.select('CallType').groupBy('CallType').count().orderBy(\"count\", ascending=False))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546582929045,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0d317df3-1338-4762-9dc9-cae9edf3678a"},{"version":"CommandV1","origId":2743960639127666,"guid":"75acf573-3c59-45d7-b641-90b2c5f92035","subtype":"command","commandType":"auto","position":9.999999046325684,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** Doing Date/Time Analysis**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bc99605c-160a-4066-9522-46d0cd5bd986"},{"version":"CommandV1","origId":2743960639127667,"guid":"9d2442b9-41c7-463d-9986-1cf1968a91d7","subtype":"command","commandType":"auto","position":9.999999523162842,"command":"%md **Q-3) How many years of Fire Service Calls is in the data file?**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"745a0e87-b0c1-440d-bc0c-4aafcb1a2a50"},{"version":"CommandV1","origId":2743960639127668,"guid":"a82a6b5b-e0d5-44cd-b4b7-7c0f3df6b1d1","subtype":"command","commandType":"auto","position":9.999999761581421,"command":"%md Notice that the date or time columns are currently being interpreted as strings, rather than date or time objects:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a5885727-d07a-4706-89d7-2fddd326b5c9"},{"version":"CommandV1","origId":2743960639127669,"guid":"7167e924-85b5-4e97-9416-77a7410b72c9","subtype":"command","commandType":"auto","position":9.99999988079071,"command":"fireServiceCallsDF.printSchema()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546583025600,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b09c877d-d51f-453f-94f0-20625ec2692e"},{"version":"CommandV1","origId":2743960639127670,"guid":"291f116e-4012-4ca2-a08e-4e9f480fbaf2","subtype":"command","commandType":"auto","position":9.999999940395355,"command":"%md Let's use the unix_timestamp() function to convert the string into a timestamp:\n\nhttps://people.apache.org/~pwendell/spark-nightly/spark-master-docs/latest/api/python/pyspark.sql.html?highlight=spark#pyspark.sql.functions.from_unixtime","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"45e40820-3abf-4e73-bdc2-963afb6e24bd"},{"version":"CommandV1","origId":2743960639127671,"guid":"199610e6-5324-4ce0-807e-e8fc1ed95bd8","subtype":"command","commandType":"auto","position":9.999999970197678,"command":"from pyspark.sql.functions import *","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546583053899,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"208cd686-dccd-46a9-88f0-f87f60f2f509"},{"version":"CommandV1","origId":2743960639127672,"guid":"b3c31b9a-6c04-4f8e-b735-7dff19b3a214","subtype":"command","commandType":"auto","position":9.999999985098839,"command":"# Note that PySpark uses the Java Simple Date Format patterns\n\nfrom_pattern1 = 'MM/dd/yyyy'\nto_pattern1 = 'yyyy-MM-dd'\n\nfrom_pattern2 = 'MM/dd/yyyy hh:mm:ss aa'\nto_pattern2 = 'MM/dd/yyyy hh:mm:ss aa'\n\n\nfireServiceCallsTsDF = fireServiceCallsDF \\\n  .withColumn('CallDateTS', unix_timestamp(fireServiceCallsDF['CallDate'], from_pattern1).cast(\"timestamp\")) \\\n  .drop('CallDate') \\\n  .withColumn('WatchDateTS', unix_timestamp(fireServiceCallsDF['WatchDate'], from_pattern1).cast(\"timestamp\")) \\\n  .drop('WatchDate') \\\n  .withColumn('ReceivedDtTmTS', unix_timestamp(fireServiceCallsDF['ReceivedDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('ReceivedDtTm') \\\n  .withColumn('EntryDtTmTS', unix_timestamp(fireServiceCallsDF['EntryDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('EntryDtTm') \\\n  .withColumn('DispatchDtTmTS', unix_timestamp(fireServiceCallsDF['DispatchDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('DispatchDtTm') \\\n  .withColumn('ResponseDtTmTS', unix_timestamp(fireServiceCallsDF['ResponseDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('ResponseDtTm') \\\n  .withColumn('OnSceneDtTmTS', unix_timestamp(fireServiceCallsDF['OnSceneDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('OnSceneDtTm') \\\n  .withColumn('TransportDtTmTS', unix_timestamp(fireServiceCallsDF['TransportDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('TransportDtTm') \\\n  .withColumn('HospitalDtTmTS', unix_timestamp(fireServiceCallsDF['HospitalDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('HospitalDtTm') \\\n  .withColumn('AvailableDtTmTS', unix_timestamp(fireServiceCallsDF['AvailableDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('AvailableDtTm') ","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546583077249,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8cf15a97-be81-4f9c-a3ff-a02237657a04"},{"version":"CommandV1","origId":2743960639127673,"guid":"04b38ead-b17e-417a-8c2b-20bebbbd3422","subtype":"command","commandType":"auto","position":9.99999999254942,"command":"fireServiceCallsTsDF.printSchema()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546583090732,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c2f8f887-00aa-4702-9586-0be7e31ea6f3"},{"version":"CommandV1","origId":2743960639127674,"guid":"b563c411-31b8-47d8-82f5-40cd966e7842","subtype":"command","commandType":"auto","position":9.99999999627471,"command":"%md Notice that the formatting of the timestamps is now different:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"89d74237-7efe-40fd-a22f-9f87b1ecd4a0"},{"version":"CommandV1","origId":2743960639127675,"guid":"12f0402f-822f-4e97-b3eb-00a6c77fc1bc","subtype":"command","commandType":"auto","position":9.999999998137355,"command":"display(fireServiceCallsTsDF.limit(5))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546583114561,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"70a0591f-1d39-4c72-9c2e-20a429304abd"},{"version":"CommandV1","origId":2743960639127676,"guid":"e8db940c-d561-4984-8f12-156b2e398efb","subtype":"command","commandType":"auto","position":9.999999999068677,"command":"%md Finally calculate how many distinct years of data is in the CSV file:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"56f42d2b-60e3-4efb-b863-6c2de00c893a"},{"version":"CommandV1","origId":2743960639127677,"guid":"40fb6a1f-6d86-4f23-b033-6da615838148","subtype":"command","commandType":"auto","position":9.999999999534339,"command":"fireServiceCallsTsDF.select(year('CallDateTS')).distinct().orderBy('year(CallDateTS)').show()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546583258994,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dc9a4cf5-63b7-4a67-9fa0-6f67968d2f01"},{"version":"CommandV1","origId":2743960639127678,"guid":"4aa5d05b-d3ff-4688-aa08-34a1d7e61091","subtype":"command","commandType":"auto","position":9.99999999976717,"command":"%md **Q-4) How many service calls were logged in between 25th December to 31st December?**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1d75972d-213a-4379-abe6-65a7880fc54c"},{"version":"CommandV1","origId":2743960639127679,"guid":"0ddcd0d2-cdb6-406e-8ee8-8fd27544ace4","subtype":"command","commandType":"auto","position":9.999999999883585,"command":"fireServiceCallsTsDF.filter(year('CallDateTS') >= '2018').filter(dayofyear('CallDateTS') >= 359).select(dayofyear('CallDateTS')).distinct().orderBy('dayofyear(CallDateTS)').show()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546585811885,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"71f34082-ce02-47ef-9c4b-578399c123e9"},{"version":"CommandV1","origId":2743960639127680,"guid":"c45e3934-09bc-4273-8aac-0054202951a6","subtype":"command","commandType":"auto","position":9.999999999941792,"command":"fireServiceCallsTsDF.filter(year('CallDateTS') >= '2018').filter(dayofyear('CallDateTS') >= 359).groupBy(dayofyear('CallDateTS')).count().orderBy('dayofyear(CallDateTS)').show()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546585830446,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"562b4409-7b1f-4be6-b502-15b513af1a2d"},{"version":"CommandV1","origId":2743960639127681,"guid":"fe5f0b27-162a-4c7e-b210-a3058c225361","subtype":"command","commandType":"auto","position":9.999999999970896,"command":"%md Visualize the results in a bar graph:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b9b46b62-420d-485b-b052-415f1a62b19b"},{"version":"CommandV1","origId":2743960639127682,"guid":"14e1ffc7-2c08-4da5-8a24-534b73afff70","subtype":"command","commandType":"auto","position":9.999999999985448,"command":"display(fireServiceCallsTsDF.filter(year('CallDateTS') >= '2018').filter(dayofyear('CallDateTS') >= 359).groupBy(dayofyear('CallDateTS')).count().orderBy('dayofyear(CallDateTS)'))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546586080938,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"674","height":"284","xColumns":["dayofyear(CallDateTS)"],"yColumns":["count"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"pieChart":[{"key":"donut","value":true}],"mgLine":[{"key":"param","value":"{\"top\":20,\"bottom\":50,\"area\":false,\"missing_is_hidden\":true,\"legend_target\":\".dummy\",\"animate_on_load\":false,\"transition_on_update\":false,\"colors\":[\"#1f77b4\",\"#ff7f0e\",\"#2ca02c\",\"#d62728\",\"#9467bd\",\"#8c564b\",\"#e377c2\",\"#7f7f7f\",\"#bcbd22\",\"#17becf\",\"#aec7e8\",\"#ffbb78\",\"#98df8a\",\"#ff9896\",\"#c5b0d5\",\"#c49c94\",\"#f7b6d2\",\"#c7c7c7\",\"#dbdb8d\",\"#9edae5\"],\"legend\":[\"count\"],\"x_label\":\"dayofyear(CallDateTS)\"}"}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e198fbf5-90d8-4a03-b268-3a58c08bb5f6"},{"version":"CommandV1","origId":2743960639127683,"guid":"d1a7967d-1917-499c-b409-6654d3997d96","subtype":"command","commandType":"auto","position":9.999999999992724,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** Memory, Caching and write to Parquet**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a5633432-b9b9-40b5-a887-74a9e72c62fb"},{"version":"CommandV1","origId":2743960639127684,"guid":"39309e86-b8c4-4f8e-90fb-5ff9cde690f5","subtype":"command","commandType":"auto","position":9.999999999996362,"command":"fireServiceCallsTsDF.rdd.getNumPartitions()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546586751186,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c4b24e85-5925-4e87-b2ca-88eb166b8b8d"},{"version":"CommandV1","origId":2743960639127685,"guid":"4daf5624-98ab-46ce-be32-6b7542bfa3d9","subtype":"command","commandType":"auto","position":9.999999999994543,"command":"%md The DataFrame is currently comprised of 13 partitions:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"031b7c9d-db0f-4146-817d-f1d05f801c8c"},{"version":"CommandV1","origId":2743960639127686,"guid":"08115870-194e-4c33-a398-fdc0dbd1d450","subtype":"command","commandType":"auto","position":9.999999999998181,"command":"fireServiceCallsTsDF.repartition(6).createOrReplaceTempView(\"fireServiceVIEW\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546586792999,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dfedcb6d-e099-430b-a14d-283488f8c5be"},{"version":"CommandV1","origId":2743960639127687,"guid":"f4398847-5a98-4e4d-ba00-c8d0db8a560c","subtype":"command","commandType":"auto","position":9.99999999999909,"command":"spark.catalog.cacheTable(\"fireServiceVIEW\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546586948773,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f06d6e49-a4e7-4ded-8fc6-01780867ba07"},{"version":"CommandV1","origId":2743960639127688,"guid":"aec325d9-1faa-407b-92e1-7798ca4b35c2","subtype":"command","commandType":"auto","position":9.999999999999545,"command":"# Call .count() to materialize the cache\nspark.table(\"fireServiceVIEW\").count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546586962986,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e680c99f-3f87-4149-9817-4f220a35d0ff"},{"version":"CommandV1","origId":2743960639127689,"guid":"9f9adbaf-05f6-4f8c-a302-59c0de384915","subtype":"command","commandType":"auto","position":9.999999999999773,"command":"fireServiceDF = spark.table(\"fireServiceVIEW\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587007142,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"39177bdf-ba30-4455-abcd-d77a152b2906"},{"version":"CommandV1","origId":2743960639127690,"guid":"8b95ba25-cd01-4b26-9e63-a0d030fd02f3","subtype":"command","commandType":"auto","position":9.999999999999886,"command":"# Note that the full scan + count in memory takes < 1 second!\n\nfireServiceDF.count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587024104,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9fd8ca86-e135-441a-9175-55827fe74659"},{"version":"CommandV1","origId":2743960639127691,"guid":"848efccb-d561-49df-ae23-978143d31bee","subtype":"command","commandType":"auto","position":9.999999999999943,"command":"spark.catalog.isCached(\"fireServiceVIEW\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587036962,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1736d346-a365-4efd-8818-133e1d1a7807"},{"version":"CommandV1","origId":2743960639127692,"guid":"c1f10df7-4735-45e2-9d39-e3c7099bfe93","subtype":"command","commandType":"auto","position":9.999999999999972,"command":"%md The 6 partitions are now cached in memory:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a7b4cf1f-1b5b-4473-b7d9-7887a8a24c07"},{"version":"CommandV1","origId":2743960639127693,"guid":"b7db3646-a262-418b-9e95-1327afbfe429","subtype":"command","commandType":"auto","position":9.999999999999986,"command":"%md ![6 Partitions](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/df_6_parts.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b746eadc-e227-472d-b702-b085fcdf35a3"},{"version":"CommandV1","origId":2743960639127694,"guid":"0527e33a-cbd5-4e24-a34d-c5dd08c970c2","subtype":"command","commandType":"auto","position":9.999999999999993,"command":"%md Use the Spark UI to see the 6 partitions in memory:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"326bfe96-c33c-4126-8d91-55380686a825"},{"version":"CommandV1","origId":2743960639127695,"guid":"813bc1e0-0d8d-4ea4-902c-3c0895cfbbad","subtype":"command","commandType":"auto","position":9.999999999999996,"command":"%md ![Mem UI](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/mem_ui.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f1defbd5-53a3-44eb-9ce2-ac0d8fe36a31"},{"version":"CommandV1","origId":2743960639127696,"guid":"68956ec3-6bf2-4281-855c-88106df5721b","subtype":"command","commandType":"auto","position":9.999999999999998,"command":"%md Now that our data has the correct date types for each column and it is correctly partitioned, let's write it down as a parquet file for future loading:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"97a7bdd7-0bec-43ef-b5a3-49120ad7c312"},{"version":"CommandV1","origId":2743960639127697,"guid":"1ead0a1d-1828-48fe-a9cc-41adaa0a47cc","subtype":"command","commandType":"auto","position":10.0,"command":"fireServiceDF.write.format('parquet').save('/temp/fireServiceParquet/')","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587159552,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"025a7680-a37f-4129-bc67-3bb2f9818589"},{"version":"CommandV1","origId":2743960639127698,"guid":"27bc1ef7-e20d-4296-ac69-078bb12691e1","subtype":"command","commandType":"auto","position":10.0,"command":"%md Now the directory should contain 6 .gz compressed Parquet files (one for each partition):","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ae25b202-3c9f-42a9-a182-ea20292e29e8"},{"version":"CommandV1","origId":2743960639127699,"guid":"488767a6-f2e0-4ac5-89a4-710dd44069aa","subtype":"command","commandType":"auto","position":10.0,"command":"%fs ls /temp/fireServiceParquet/","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587417483,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b2b6231d-52c4-4299-a5dd-9e66951970fc"},{"version":"CommandV1","origId":2743960639127700,"guid":"8a798f47-96ef-4515-95ae-1844fd4b4a4c","subtype":"command","commandType":"auto","position":10.0,"command":"%md Here's how you can easily read the parquet file in the future:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a8d212a1-2993-41ff-a8c9-765ab70b6950"},{"version":"CommandV1","origId":2743960639127701,"guid":"b88ebae3-9611-48ab-a320-d900e2482ad1","subtype":"command","commandType":"auto","position":10.0,"command":"tempDF = spark.read.parquet('/tmp/fireServiceParquet/')","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587454563,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"79a867f9-8ab0-4241-b32b-0f8d0aba328a"},{"version":"CommandV1","origId":2743960639127702,"guid":"04770e8b-757a-4a54-9780-8816b52aa0de","subtype":"command","commandType":"auto","position":10.0,"command":"display(tempDF.limit(2))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587463600,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4391ccc5-4907-4cc6-9b7a-40591fea51ef"},{"version":"CommandV1","origId":2743960639127703,"guid":"73fb11d1-0431-4f9e-9702-0884a8b193fa","subtype":"command","commandType":"auto","position":11.0,"command":"%sql SELECT count(*) FROM fireServiceVIEW;","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587569287,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f0f40f47-e3f4-4cfb-81a1-df54ba21f400"},{"version":"CommandV1","origId":2743960639127704,"guid":"89744b53-342f-40a1-ae52-947d1cb10030","subtype":"command","commandType":"auto","position":10.5,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **SQL Queries**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2955b19c-3900-4058-b835-d0dadfd7d49b"},{"version":"CommandV1","origId":2743960639127705,"guid":"595d6961-cb09-46c5-a5d6-67cd71d88bdb","subtype":"command","commandType":"auto","position":12.0,"command":"%md Explain the 'Spark Jobs' in the cell above to see that 7 tasks were launched to run the count... 6 tasks to reach the data from each of the 6 partitions and do a pre-aggregation on each partition, then a final task to aggregate the count from all 6 tasks:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7897e1e7-6f3e-43b0-ab62-e72c401d1b41"},{"version":"CommandV1","origId":2743960639127706,"guid":"faaad4c6-6d25-4a4a-8fae-61ed6276387d","subtype":"command","commandType":"auto","position":13.0,"command":"%md ![Job details](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/6_tasks.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2e11740d-613f-44f3-bf13-1ab74b8805b3"},{"version":"CommandV1","origId":2743960639127707,"guid":"d11c2692-5cf9-4b2a-a229-f7ef9f8fb48d","subtype":"command","commandType":"auto","position":14.0,"command":"%md You can use the Spark Stages UI to see the 6 tasks launched in the middle stage:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"417dbaf4-c064-4fd1-a349-2670550ec476"},{"version":"CommandV1","origId":2743960639127708,"guid":"049d05ca-6820-4915-8b59-d5119d6b1d5d","subtype":"command","commandType":"auto","position":15.0,"command":"%md ![Event Timeline](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/event_timeline.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"13cdae88-4653-4d86-8ecc-cfbbd4adb163"},{"version":"CommandV1","origId":2743960639127709,"guid":"39942de3-199c-4c21-b865-67511151b2f2","subtype":"command","commandType":"auto","position":16.0,"command":"%md **Q-5) Which neighborhood generated the most calls last year?**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c4253733-6e99-4517-bb35-33ef4ea69339"},{"version":"CommandV1","origId":2743960639127710,"guid":"8cb43621-4874-45bf-84f1-693f886a39a4","subtype":"command","commandType":"auto","position":17.0,"command":"%sql SELECT `NeighborhoodDistrict`, count(`NeighborhoodDistrict`) AS Neighborhood_Count FROM fireServiceVIEW WHERE year(`CallDateTS`) == '2018' GROUP BY `NeighborhoodDistrict` ORDER BY Neighborhood_Count DESC LIMIT 15;","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546587824759,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"643d9fbf-676c-4a96-ba3b-8cf7b87cebea"},{"version":"CommandV1","origId":2743960639127711,"guid":"e347d2af-5f9c-48b2-8cb3-1ace33183e7c","subtype":"command","commandType":"auto","position":18.0,"command":"%md Expand the Spark Job details in the cell above and notice that the last stage uses 200 partitions! This is default is non-optimal, given that we only have ~1.6 GB of data and 3 slots.\n\nChange the shuffle.partitions option to 6:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b7f990af-3eed-412d-913d-62f2c4c6a86f"},{"version":"CommandV1","origId":2743960639127712,"guid":"3090fdb0-3ffd-4ab3-b513-ac5496593ae9","subtype":"command","commandType":"auto","position":19.0,"command":"spark.conf.get(\"spark.sql.shuffle.partitions\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588016319,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a8282144-94cb-4e27-9948-582dc6f13ca7"},{"version":"CommandV1","origId":2743960639127713,"guid":"4b4dddbc-317f-4070-b527-be7d8b56a2c9","subtype":"command","commandType":"auto","position":20.0,"command":"spark.conf.set(\"spark.sql.shuffle.partitions\", 6)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588030379,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0559a394-4b0e-45e8-8051-6c5b56044f1d"},{"version":"CommandV1","origId":2743960639127714,"guid":"3b07984c-024c-4c6e-a410-df7b34ad9d4f","subtype":"command","commandType":"auto","position":21.0,"command":"spark.conf.get(\"spark.sql.shuffle.partitions\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588040420,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"87f78ec9-4d6f-466d-9ab3-7457089e6944"},{"version":"CommandV1","origId":2743960639127715,"guid":"4a3960eb-fa67-4f81-a75c-75ca72f52e2d","subtype":"command","commandType":"auto","position":22.0,"command":"%md Re-run the same SQL query and notice the speed increase:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"028ef7e8-ddee-4eaf-9cd6-0d820f26e329"},{"version":"CommandV1","origId":2743960639127716,"guid":"b9411fb3-deb4-47bb-bb95-6058e7313be7","subtype":"command","commandType":"auto","position":23.0,"command":"%sql SELECT `NeighborhoodDistrict`, count(`NeighborhoodDistrict`) AS Neighborhood_Count FROM fireServiceVIEW WHERE year(`CallDateTS`) == '2018' GROUP BY `NeighborhoodDistrict` ORDER BY Neighborhood_Count DESC LIMIT 15;","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546594896568,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a3b72294-1014-4d5b-8126-1a563437ceb5"},{"version":"CommandV1","origId":2743960639127717,"guid":"15ac3b28-0afd-4284-9ea8-067e58b52a44","subtype":"command","commandType":"auto","position":24.0,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** Spark Internals and SQL UI**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b6b487b7-790d-40a8-b06b-646239ad46ff"},{"version":"CommandV1","origId":2743960639127718,"guid":"cbff47e7-5e17-4d87-b4ba-75f7378832bf","subtype":"command","commandType":"auto","position":25.0,"command":"%md ![Catalyst](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/catalyst.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"969bb911-5f54-44bb-93dc-7c83d88886a1"},{"version":"CommandV1","origId":2743960639127719,"guid":"a6fdc8f6-7b48-4390-bb44-8ac4a1acc517","subtype":"command","commandType":"auto","position":26.0,"command":"# Note that a SQL Query just returns back a DataFrame\nspark.sql(\"SELECT `NeighborhoodDistrict`, count(`NeighborhoodDistrict`) AS Neighborhood_Count FROM fireServiceVIEW WHERE year(`CallDateTS`) == '2015' GROUP BY `NeighborhoodDistrict` ORDER BY Neighborhood_Count DESC LIMIT 15\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588102254,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c611c02e-9c42-401d-b6a2-8081d00e42db"},{"version":"CommandV1","origId":2743960639127720,"guid":"ebd9967f-2dc9-4157-a5fb-02e6a04f63a5","subtype":"command","commandType":"auto","position":27.0,"command":"%md The `explain()` method can be called on a DataFrame to understand its logical + physical plans:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c4614b31-c1b0-4532-a52f-ac84ec684588"},{"version":"CommandV1","origId":2743960639127721,"guid":"9fded5bd-15fb-473d-a5ff-359e4291e7d6","subtype":"command","commandType":"auto","position":28.0,"command":"spark.sql(\"SELECT `NeighborhoodDistrict`, count(`NeighborhoodDistrict`) AS Neighborhood_Count FROM fireServiceVIEW WHERE year(`CallDateTS`) == '2015' GROUP BY `NeighborhoodDistrict` ORDER BY Neighborhood_Count DESC LIMIT 15\").explain(True)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588122928,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1d23b53b-38f2-4c82-8900-b44e08923139"},{"version":"CommandV1","origId":2743960639127722,"guid":"dbd585e1-36e5-41bb-b5d1-291625ff8b3c","subtype":"command","commandType":"auto","position":29.0,"command":"%md You can view the visual representation of the SQL Query plan from the Spark UI:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"186754e4-31bb-4225-b657-4395925a1e7f"},{"version":"CommandV1","origId":2743960639127723,"guid":"9caca533-219d-4eb6-bd76-cdf207e6a048","subtype":"command","commandType":"auto","position":30.0,"command":"%md ![SQL Plan](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/sql_query_plan.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c1662b4b-5634-4df9-81b2-6be64bf6daf5"},{"version":"CommandV1","origId":2743960639127724,"guid":"b239226d-1138-4b66-a429-8490dd4ddf37","subtype":"command","commandType":"auto","position":31.0,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** DataFrame Joins**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f1dd649c-5ded-40d2-9248-77017868e33f"},{"version":"CommandV1","origId":2743960639127725,"guid":"3ce6b3d9-3fcb-430c-850b-645a3817415f","subtype":"command","commandType":"auto","position":32.0,"command":"%md **Q-6) What was the primary non-medical reason most people called the fire department from the Tenderloin last year?**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"89d2a7ba-5881-4298-8c5d-c3f8d5beec8a"},{"version":"CommandV1","origId":2743960639127726,"guid":"cb36b06d-b9c1-447d-aff5-d3851ff95ac9","subtype":"command","commandType":"auto","position":33.0,"command":"%md The \"Fire Incidents\" data includes a summary of each (non-medical) incident to which the SF Fire Department responded.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"11adc949-00b6-4c2c-975f-de10b79db4d8"},{"version":"CommandV1","origId":2743960639127727,"guid":"8bc453f1-0bd0-4223-b219-e15f2f286884","subtype":"command","commandType":"auto","position":34.0,"command":"%md Let's do a join to the Fire Incidents data on the \"Incident Number\" column:\n\nhttps://data.sfgov.org/Public-Safety/Fire-Incidents/wr8u-xric","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f5ddd01d-c6f7-4e77-aba5-57a85b46237c"},{"version":"CommandV1","origId":2743960639127728,"guid":"7dbe83cf-9ec6-4a3f-acfc-ffae2117637f","subtype":"command","commandType":"auto","position":35.0,"command":"%md Read the Fire Incidents CSV file into a DataFrame:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7ed55760-33a5-41e3-819c-e3a1666ca0f8"},{"version":"CommandV1","origId":2743960639127729,"guid":"98beab7b-b932-4df4-8bb8-c50c4844edd1","subtype":"command","commandType":"auto","position":36.0,"command":"incidentsDF = spark.read.csv('/mnt/firedata/Fire_Incidents.csv', header=True, inferSchema=True).withColumnRenamed('Incident Number', 'IncidentNumber').cache()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588260127,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ec47e181-1137-48c0-8728-370bbf38dedb"},{"version":"CommandV1","origId":2743960639127730,"guid":"6ac1f84a-de5c-4a22-bd3e-aad2d607ff89","subtype":"command","commandType":"auto","position":37.0,"command":"incidentsDF.printSchema()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588277303,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7311f2cb-0e5a-446b-9931-fd9fb4ef64a5"},{"version":"CommandV1","origId":2743960639127731,"guid":"820a8ab8-5caa-4849-b8aa-a5c86e070a60","subtype":"command","commandType":"auto","position":38.0,"command":"# Materialize the cache\nincidentsDF.count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588295361,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5c1769b7-af23-4796-8e74-a40ee23978fd"},{"version":"CommandV1","origId":2743960639127732,"guid":"a8c91428-77cf-4668-9013-fe3a92a0f338","subtype":"command","commandType":"auto","position":39.0,"command":"display(incidentsDF.limit(3))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588315194,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"86e07849-b23f-415c-a80d-53cb6cb8f715"},{"version":"CommandV1","origId":2743960639127733,"guid":"55d1813a-2f4e-402f-8a3b-d2b92c261593","subtype":"command","commandType":"auto","position":40.0,"command":"joinedDF = fireServiceDF.join(incidentsDF, fireServiceDF.IncidentNumber == incidentsDF.IncidentNumber)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588329350,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1f47bc5a-415d-4c7a-9784-87cf446cf794"},{"version":"CommandV1","origId":2743960639127734,"guid":"ec33a5c0-5894-4a8f-80c6-70be83510900","subtype":"command","commandType":"auto","position":41.0,"command":"display(joinedDF.limit(3))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588340357,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0f32a277-538b-4904-b0d6-67d99d16fdb3"},{"version":"CommandV1","origId":2743960639127735,"guid":"05636865-b6ed-4479-8e1e-dd0aec5ec041","subtype":"command","commandType":"auto","position":42.0,"command":"#Note that the joined DF is only 1.1 million rows b/c we did an inner join (the original Fire Service Calls data had 4+ million rows)\njoinedDF.count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588368364,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0d0a461c-9956-4f26-a63f-7cdfac55735a"},{"version":"CommandV1","origId":2743960639127736,"guid":"2a0e91a2-9cca-4db4-b5c8-c78a768cebab","subtype":"command","commandType":"auto","position":43.0,"command":"joinedDF.filter(year('CallDateTS') == '2018').filter(col('NeighborhoodDistrict') == 'Tenderloin').count()","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546597871827,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"49d3992d-a9bd-41eb-b5b0-9d23a8fd6c2d"},{"version":"CommandV1","origId":2743960639127737,"guid":"80168599-b828-45a0-bf40-0eb8f3cf3e6c","subtype":"command","commandType":"auto","position":44.0,"command":"display(joinedDF.filter(year('CallDateTS') == '2018').filter(col('NeighborhoodDistrict') == 'Tenderloin').groupBy('Primary Situation').count().orderBy(desc(\"count\")).limit(10))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546597868335,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b996c98d-076c-49ad-b818-7f1fbf12b71a"},{"version":"CommandV1","origId":2743960639127738,"guid":"9f15b43b-cd12-45bc-b7b3-abca9bf80a80","subtype":"command","commandType":"auto","position":45.0,"command":"%md Most of the calls were False Alarms!","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"02aa89d6-5f04-4660-9918-29c7a26673a8"},{"version":"CommandV1","origId":2743960639127739,"guid":"e09f0e5d-5d63-4993-8408-7364fe8a9fc9","subtype":"command","commandType":"auto","position":46.0,"command":"%md What do residents of Russian Hill call the fire department for?","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c7f8989c-5b75-44c9-ba3b-21d950d7f683"},{"version":"CommandV1","origId":2743960639127740,"guid":"e085c6fd-062d-4fb1-88a4-0d47f988850b","subtype":"command","commandType":"auto","position":47.0,"command":"display(joinedDF.filter(year('CallDateTS') == '2015').filter(col('NeighborhoodDistrict') == 'Russian Hill').groupBy('Primary Situation').count().orderBy(desc(\"count\")).limit(10))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546588455593,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"16c034c4-b82c-470b-8cfb-98cbaec3fd0b"},{"version":"CommandV1","origId":2743960639127741,"guid":"f491f3f6-dc7c-4969-9011-30b9a8a42791","subtype":"command","commandType":"auto","position":48.0,"command":"%md ### ** Keep Hacking! **","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"70346c33-faf3-4d27-8990-e6c3859f39b7"},{"version":"CommandV1","origId":2743960639127743,"guid":"eba81e8c-7745-483a-bb21-c00024ebc18d","subtype":"command","commandType":"auto","position":47.5,"command":"%md # DIY:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"69041425-b881-4472-8972-e703d3949031"},{"version":"CommandV1","origId":2743960639127744,"guid":"f00c1b86-820c-411f-bc63-7f2cfd473a31","subtype":"command","commandType":"auto","position":47.75,"command":"%md **Ex1.** Count average number of fire personnels (Suppresion) involved for each CallType for the year 2018 . Use the `Suppression Personnel` and `CallType` columns from our `joinedDF` to get the average number of Fire personnel for each incident. Order them by the average values in descending order to get the Call Types which deploys the highest number of Firefighters.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"21d4373a-3902-4ec5-9adb-21d2bb49261b"},{"version":"CommandV1","origId":2743960639127748,"guid":"12768225-1e58-48f1-8883-9c90c7e43c92","subtype":"command","commandType":"auto","position":47.875,"command":"%python","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546600118426,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6504dcdf-c120-4861-b21f-0b1a0f6d5bf1"},{"version":"CommandV1","origId":2743960639127749,"guid":"afeaa6b8-6035-4c7d-bd3b-b8868603b98d","subtype":"command","commandType":"auto","position":47.625,"command":"%md To run SQL queries on our DataFrame, we need to create a Temp View and run queries on the view.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c416d361-6312-4ea0-960a-2ba31f74b42f"},{"version":"CommandV1","origId":2743960639127750,"guid":"7e47b90b-8f15-45cd-9ccd-c7bfca69e26f","subtype":"command","commandType":"auto","position":47.6875,"command":"joinedDF.createOrReplaceTempView(\"fireIncidentsView\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546597566123,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"241ebd21-ce91-443f-bdd4-51d27850b1e6"},{"version":"CommandV1","origId":2743960639127751,"guid":"54cd6fd4-4505-417a-9de8-1949a0e1ec7c","subtype":"command","commandType":"auto","position":47.9375,"command":"%sql","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546600215566,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"aa447c39-956c-48cd-8ce2-6eb5d54bdc5c"},{"version":"CommandV1","origId":2743960639127754,"guid":"4e94c1ed-b77d-40f5-a7ea-d3acfd25d092","subtype":"command","commandType":"auto","position":47.96875,"command":"%md **Ex.2** Busiest Unit of 2018 : Get the Fire Unit which was involved in most call in the year 2018. Group the data by column `UnitType` and order them by decreasong count of occurences to get the busiest unit of 2018.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e76ce1c4-13c0-46e4-833b-bf905bbb1182"},{"version":"CommandV1","origId":2743960639127755,"guid":"bfe00db3-2a8c-4065-a9e9-cdf3b47af522","subtype":"command","commandType":"auto","position":47.984375,"command":"%python","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546600262954,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fe3d0d00-4279-478f-a1e1-c89c21835370"},{"version":"CommandV1","origId":2743960639127760,"guid":"3267f953-6bf8-40ac-86a2-97683cc32a5c","subtype":"command","commandType":"auto","position":47.9921875,"command":"%md **Ex.3** Most Deadly Month : Get number of Civilian Fatalities by each month and order them in decreasing order to find the month with the highest civilian casualities. Apply the `month()` function of pyspark.sql.functions on the column `CallDateTS` to extract the month and perform sum aggregation on `Civilian Fatalities` column to get month vise fatality count.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"479161de-f487-436c-9ec6-ebdab08b25e9"},{"version":"CommandV1","origId":2743960639127761,"guid":"a826743c-2c20-4dae-821d-5b27928e25f6","subtype":"command","commandType":"auto","position":47.98828125,"command":"%sql","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546600731116,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"971cb9bf-fa6d-4240-88ff-0d2e022dc9fd"},{"version":"CommandV1","origId":2743960639127765,"guid":"c58d814f-127d-413b-996e-954bab1f3e09","subtype":"command","commandType":"auto","position":47.99609375,"command":"%python","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546602229138,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"451eb472-b6ba-4b55-903a-daed647683bf"},{"version":"CommandV1","origId":2743960639127768,"guid":"b0f3ec98-ee09-4401-9871-3dcabbc6dfb7","subtype":"command","commandType":"auto","position":47.998046875,"command":"%sql","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546603135261,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"1699","height":"392","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"53f5d59a-5e3e-488f-84f6-4a82daac698d"},{"version":"CommandV1","origId":2743960639127772,"guid":"1de76a2f-9a1f-4dd2-801b-63ff4358e222","subtype":"command","commandType":"auto","position":47.9990234375,"command":"%md #MACHINE LEARNING USING SPARK ML IN DATABRICKS","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fac0a1db-d1d1-48e4-804b-2b17bd67e5b0"},{"version":"CommandV1","origId":2743960639127773,"guid":"295d5dd7-9471-4f6b-8674-369251d518cc","subtype":"command","commandType":"auto","position":47.99951171875,"command":"%md MLlib is Sparks machine learning (ML) library. Its goal is to make practical machine learning scalable and easy. At a high level, it provides tools such as:\n\n- ML Algorithms: common learning algorithms such as classification, regression, clustering, and collaborative filtering\n- Featurization: feature extraction, transformation, dimensionality reduction, and selection\n- Pipelines: tools for constructing, evaluating, and tuning ML Pipelines\n- Persistence: saving and load algorithms, models, and Pipelines\n- Utilities: linear algebra, statistics, data handling, etc.\n\nThe advantages of MLlibs design include:\n\n- **Simplicity:** Simple APIs familiar to data scientists coming from tools like R and Python. Novices are able to run algorithms out of the box while experts can easily tune the system by adjusting important knobs and switches (parameters).\n- **Scalability:** Ability to run the same ML code on your laptop and on a big cluster seamlessly.\n- **Streamlined end-to-end:** Developing machine learning models is a multistep journey from data ingest through trial and error to production. Building MLlib on top of Spark makes it possible to tackle these distinct needs with a single tool instead of many disjointed ones. The advantages are lower learning curves, less complex development and production environments, and ultimately shorter times to deliver high-performing models.\n- **Compatibility:** Data scientists often have workflows built up in common datascience tools such as R, Python pandas and scikit-learn. Spark DataFrames and MLlib provide tooling that makes it easier to integrate these existing workflows with Spark. For example, SparkR allows users to call MLlib algorithms using familiar R syntax, and Databricks is writing Spark packages in Python to allow users to distribute parts of scikit-learn workflows.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"65967187-ec94-46e2-b923-c889642a9a22"},{"version":"CommandV1","origId":2743960639127778,"guid":"f1e9a813-acb8-4680-97fb-50660d543b27","subtype":"command","commandType":"auto","position":47.99993896484375,"command":"selectionDF = fireServiceDF.select(\"CallType\",\"StationArea\",\"FinalPriority\",\"NumberofAlarms\",\"UnitType\",\"ReceivedDtTmTS\",\"DispatchDtTmTS\",\"ALSUnit\").withColumn(\"responseTime\",unix_timestamp(\"DispatchDtTmTS\") - unix_timestamp(\"ReceivedDtTmTS\")).withColumn(\"StationArea\",fireServiceDF.StationArea.cast(IntegerType())).withColumn(\"ALSUnit\",fireServiceDF.ALSUnit.cast(IntegerType()))\n","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546610588107,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"87f0bb61-0af0-4b97-a0bc-d84c4274b2bd"},{"version":"CommandV1","origId":2743960639127779,"guid":"4165399c-1f88-4dd8-ab24-8497260f68aa","subtype":"command","commandType":"auto","position":47.999969482421875,"command":"from pyspark.ml import Pipeline\nfrom pyspark.ml.feature import StringIndexer\nfrom pyspark.ml.linalg import Vectors\nfrom pyspark.ml.feature import VectorAssembler\nfrom pyspark.ml.classification import DecisionTreeClassifier\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator\n\nindexerCallType = StringIndexer(inputCol=\"CallType\", outputCol=\"CallTypeIndex\", handleInvalid=\"skip\")\nindexerUnitType = StringIndexer(inputCol=\"UnitType\", outputCol=\"UnitTypeIndex\", handleInvalid=\"skip\")\n\nassembler = VectorAssembler(\n    inputCols=[\"CallTypeIndex\", \"UnitTypeIndex\", \"StationArea\", \"FinalPriority\", \"responseTime\"],\n    outputCol=\"features\", handleInvalid=\"skip\")\n\ndt = DecisionTreeClassifier(maxDepth=3, labelCol=\"ALSUnit\", featuresCol=\"features\")\n\npipeline = Pipeline(stages=[indexerCallType, indexerUnitType, assembler, dt])\n\nmodel = pipeline.fit(training)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546610913859,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cb0e4470-1f14-4db7-941a-64e9f28b7f17"},{"version":"CommandV1","origId":2743960639127782,"guid":"a0652b10-7d2c-40ac-b8f1-36cea3fae76d","subtype":"command","commandType":"auto","position":47.999961853027344,"command":"training = selectionDF.filter(year(\"DispatchDtTmTS\")!=2018)\ntest = selectionDF.filter(year(\"DispatchDtTmTS\")==2018)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546610605562,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c2179877-a566-444d-956b-b8020e1676f7"},{"version":"CommandV1","origId":2743960639127783,"guid":"939b6599-fc2c-4f02-818b-2449b3a06eff","subtype":"command","commandType":"auto","position":47.99996566772461,"command":"print(training.count(),test.count())","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546608362119,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b750fe59-187e-4b50-ba4a-ea4121ee4f52"},{"version":"CommandV1","origId":2743960639127786,"guid":"1509e7de-eeaf-4c52-8c2b-374b96ce0e3f","subtype":"command","commandType":"auto","position":47.999977111816406,"command":"predictions = model.transform(test)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546610942541,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5e99abcf-99bf-4fd3-85b2-9dfa84548e5f"},{"version":"CommandV1","origId":2743960639127788,"guid":"a031e26c-0da8-4958-97e2-8e4f489934f6","subtype":"command","commandType":"auto","position":47.999996185302734,"command":"display(predictions.select(\"ALSUnit\",\"prediction\"))","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546610944535,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"55a6eb11-d8c1-4479-83e7-31c3aec999e3"},{"version":"CommandV1","origId":2743960639127793,"guid":"d731b4b7-be4b-48fc-9b0f-a7df7a29b8fd","subtype":"command","commandType":"auto","position":47.99999713897705,"command":"evaluator = MulticlassClassificationEvaluator(\n    labelCol=\"ALSUnit\", predictionCol=\"prediction\", metricName=\"accuracy\")\naccuracy = evaluator.evaluate(predictions)\nprint(accuracy)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546611010944,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1170fc68-c66a-4462-9b27-0314c3eb9100"},{"version":"CommandV1","origId":2743960639127794,"guid":"82755113-1324-43c5-86b7-8e46cb399122","subtype":"command","commandType":"auto","position":47.999908447265625,"command":"%md ## PREDICTING THE CHANCES OF A FIRE INCIDENT BEING CRITICAL ##\n\nOur ML scenario will involve predicting whether a fire incident requires ALS i.e Advanced Life Support or not. ALS is a special team of fire personnel deployed for critical scenarios. The column we'll predict is `ALSUnit`, a boolean column. We have selected the following columns as features from the `fireServiceDF` DF :\n\n- CallType\n- StationArea\n- FinalPriority\n- NumberofAlarms\n- UnitType - Categorical\n- Response Time (derived feature) = DispatchDtTmTS - ReceivedDtTmTS\n\n\nSince it is a classification problem, we'll use the Decision Tree Algorithm for our use case.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a8d44964-f9a7-47e7-aa95-ab9b11e9364e"},{"version":"CommandV1","origId":4116714212312314,"guid":"3c24fe1e-0ee2-49fd-a0f3-644a8a525c29","subtype":"command","commandType":"auto","position":1.0,"command":"%md ### **DATABRICKS**![Databricks Logo](https://d1e2wseyxx8ugp.cloudfront.net/organization-logos/databricks.com) + ![CelebalTech Logo](http://www.celebaltech.com/assets/images/newlogo1.png)","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ace90596-ef44-48e5-b820-65584027b2c0"},{"version":"CommandV1","origId":4116714212312316,"guid":"ab13342a-1b59-431a-b5c6-33052d31236f","subtype":"command","commandType":"auto","position":2.0,"command":"%md Mount the data:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9be8cee2-b1f0-410e-85fd-007b7fc6e213"},{"version":"CommandV1","origId":4116714212312317,"guid":"48db7194-60e6-47b4-869d-665aaf7f6ed6","subtype":"command","commandType":"auto","position":3.0,"command":"dbutils.fs.mount(\n  source = \"wasbs://fireincidents@bootcampfiredata.blob.core.windows.net\",\n  mount_point = \"/mnt/firedata\",\n  extra_configs = {\"fs.azure.account.key.bootcampfiredata.blob.core.windows.net\":\"JBJWq0bQaCkYW9Rn4CbY+bmtUJtg3RZO0/mF2zYral4vRBji5sxCEq1uJJ35rOALknnoBONY41PKOQQDK2pJyQ==\"})","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546520701172,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8f376b84-2eba-4f03-802c-7e0048bdce57"},{"version":"CommandV1","origId":4116714212312321,"guid":"cfa45cdf-7b7a-4b37-85bb-6d6ac24456d6","subtype":"command","commandType":"auto","position":4.0,"command":"%fs ls /mnt/firedata","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546521081458,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"52f88800-cc08-49c2-bdf0-3b3f5cf1d69c"},{"version":"CommandV1","origId":4116714212312322,"guid":"d401776a-287a-4174-9e6c-ff78d1caf446","subtype":"command","commandType":"auto","position":5.0,"command":"%md ## Exploring the Fire Incidents public data with Apache Spark","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4eb630b1-c602-4f4f-be54-a2dd68248c1d"},{"version":"CommandV1","origId":4116714212312323,"guid":"d99b2eed-41d5-4749-a120-adc1ed15a8dc","subtype":"command","commandType":"auto","position":6.0,"command":"%md The SF OpenData project was launched in 2009 and contains hundreds of datasets from the city of San Francisco. Open government data has the potential to increase the quality of life for residents, create more efficient government services, better public decisions, and even new local businesses and services.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fbc7bf93-9cf8-44f5-8c7c-230ae6969960"},{"version":"CommandV1","origId":4116714212312326,"guid":"78dcdd46-cb60-4351-bba9-d39ae47cf986","subtype":"command","commandType":"auto","position":9.0,"command":"%md How did the Christmas and New Year holiday affect demand for Firefighters?","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"11743c85-88ee-4b5e-a6e5-d247106d3bf3"},{"version":"CommandV1","origId":4116714212312328,"guid":"7d095463-ec69-469b-a5d9-2edaad74f7ea","subtype":"command","commandType":"auto","position":9.5,"command":"from pyspark.sql.types import StructType, StructField, IntegerType, StringType, BooleanType","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1546581970637,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"prarbdh.ranjan@celebaltech.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5a55a686-6d2f-4165-b953-c049206e0376"}],"dashboards":[],"guid":"58474dc1-43db-4f8b-9c10-e9adcfda682d","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}